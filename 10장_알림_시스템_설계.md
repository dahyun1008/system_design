# 알림 시스템 설계

* SMS, 푸시, 이메일 등의 알림은 외부 api를 통해 이용할 수 있음
* 대규모 시스템에서 외부 api를 안정적으로 사용하기 위한 아키텍쳐 설계 필요

* 고려해야 할 컴포넌트들은 아래와 같음
    * 처리율 제한: 한 유저에게 너무 많은 알림이 전송되는 것을 방지. 유저의 알림 허용 여부 체크 후, 지난 일정 시간 내에 알림 요청 발생한 유저는 처리율 제한 확인되어야 함
    * 유저의 알림 허용 여부: 알림 서버에서 디비 조회로 알림 허용 여부에 따라 알림 요청 처리 또는 폐기
    * 중복 알림 방지: 메시지 큐 소비 부분에서 at most once를 구현하기 위해 오프셋 커밋 시점 조절(트랜잭션 없이 오프셋 커밋을 api 성공 후로 미루면 재처리 발생 가능)
    * 알림 요청 유실 방지: 메시지큐 오프셋 커밋을 알림 전송과 트랜잭션으로 묶어서 at least once 구현, 외부 api 서버가 일정 횟수 실패 시 알림 요청을 dlq로 이동
    * 대규모 알림 요청 처리: 무상태 서버 구조를 통해 확장 가능, 알림 요청은 안정 해시를 통해 알림 서버들에 균등 분산됨
    * 모니터링: 각각의 알림 큐 메시지량 모니터링 -> 각각의 알림 서버 증감 관리 (큐에 쌓이는 메시지가 많으면 )