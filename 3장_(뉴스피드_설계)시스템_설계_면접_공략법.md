# 3장: 시스템 설계 면접 공략법
주어진 기능이 '뉴스 피드 발행 및 구독이라 할때, 최대한 기능을 구체화하기
* 뉴스 피드는 누가에게 보여지는가 -> 친구
* 뉴스 피드는 무슨 기준으로 보여지는가 -> 시간 역순(최신순)
* 뉴스 피드에는 무슨 데이터가 포함되는가 -> 텍스트, 이미지, 영상
* 서비스 환경은 무엇인가 -> 웹, 앱 모두
* DAU 1천만 명, 친구 최대 5천 명

## 뉴스 피드 기능 설계하기: 뉴스 발행부터 친구에게 알림까지
* 이미지, 영상 리소스는 클라이언트의 단말에서 CDN으로 전송하고 서버로는 메타 데이터 전송
* 로드밸런서를 통해 들어온 피드 발행 요청은 웹 서버에서 데이터 저장소에 쓰인다
    * 뉴스 피드 서비스의 특성: 쓰기:읽기 비율 = 1:8이라 가정
    * 친구의 뉴스 피드는 조회될 가능성이 높음
    * write-through, write-back+aof 복구 전략
    * write-through는 쓰기 지연이 발생함
    * 뉴스 피드 조회 요청에서 캐시 조회를 할 수 있고, 캐시와 디비 간 높은 정합성을 요구하지 않음 -> write-back + aof(append only file) 복구 전략도 괜찮음
* 현재 활동 중이지 않은 유저는 재접속 시, api 호출을 통해 뉴스 피드 조회 가능
* 현재 활동 중인 유저에게 실시간으로 피드를 제공하기 위해서는 아래와 같은 아키텍쳐 추가
    * 피드 발행 메시지(누가 피드를 발행했다는 정보)를 카프카에 적재
    * 알림 전송 서버: 친구 관계 그래프 DB와 유저 DB를 조회하여 해당 피드 알림을 받아야 할 유저들 확인 -> 레디스 펍/섭에 각 유저에 대한 알림 요청 보냄
    * 연결 서버: 실제 활동 중인 유저와 연결 유지. 구독 중인 레디스 펍/섭에 자신과 연결 중인 유저가 받아야 할 알림이 있다면 SSE를 통해 유저에게 알림 전송
    * 연결 서버 다중화: 여러 유저에게 동시에 피드 실시간 알림을 보내기 위해 레디스 펍/섭에서 연결 중인 서버들에 브로드캐스팅하므로써 연결 서버가 선택적으로 자신과 연결 중인 유저에 대한 알림 요청 처리